# Playwright Architecture

## Overview

Persistent browser controller with state management between script executions.

```
┌─────────────────────────────────────┐
│       Browser Controller            │
│  - Singleton browser instance       │
│  - Page state persistence           │
│  - Element ref management           │
└──────────────┬──────────────────────┘
               │
┌──────────────▼──────────────────────┐
│       Individual Scripts            │
│  navigate, click, type, etc.        │
└─────────────────────────────────────┘
```

## State Files

| File | Purpose |
|------|---------|
| `.browser-state.json` | Current URL, title, timestamp |
| `.element-refs.json` | Element refs from last snapshot |
| `.storage-state.json` | Cookies, localStorage, sessionStorage |

## Script Structure

Each script:
1. Imports `getController()` (singleton)
2. Parses CLI arguments
3. Calls controller method
4. Outputs JSON result

## Key Concepts

### Element References
- Generated by `snapshot.js`
- Format: `ref1`, `ref2`, etc.
- Map to accessibility tree nodes
- Expire on DOM changes

### Output Format

Success:
```json
{"success": true, "data": {...}}
```

Error:
```json
{"success": false, "error": "message"}
```

## File Organization

```
scripts/
├── browser-controller.js   # Singleton controller
├── utils/
│   ├── state-manager.js    # File-based state
│   └── output-formatter.js # JSON output
├── navigate.js             # Navigation
├── snapshot.js             # Element discovery
├── click.js                # Interactions
└── ...                     # Other scripts
```
